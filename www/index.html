
<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<title>Day Tracker Pro</title>  
<link rel="manifest" href="manifest.json" />  
<meta name="theme-color" content="#2563eb" />  
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
<style> 
:root {  
  --primary: linear-gradient(90deg, #4C81FF, #7165FF);
  --bg-light: linear-gradient(135deg, #667eea 0%, #764ba2 100%);;  
  --bg-dark: #1F2937;  
  --text-light: #1B1C1D;  
  --text-dark: #f9fafb;  
  --overlay: rgba(0,0,0,0.6);  
  --card1:linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  --card2: linear-gradient(135deg, #FFC123 0%, #ff5e62 100%);
  --card3:linear-gradient(125deg, #56ab2f 0%, #a8e063 100%);
  --card4:linear-gradient(135deg, #da22ff 0%, #979DFC 100%);
  --card5: linear-gradient(15deg, #43cea2 0%, #185a9d 100%);  
}  
:root {
  --text-primary: #222;
  --text-secondary: #555;
  --background: #fff;
  --separator-color: #999;
}

body.dark {
  --primary:  linear-gradient(90deg, #1e3c72, #2a5298);
  --text-primary: #eee;
  --text-secondary: #bbb;
  --background: #121212;
  --separator-color: #ACACAC;
 --card1:linear-gradient(145deg, #1a1a1a, #2d1b4e);
  --card2: linear-gradient(160deg, #0f2027, #203a43, #2c5364);
  --card3:linear-gradient(135deg, #0f2027, #1a2f1f, #203a43);
  --card4:linear-gradient(145deg, #1b0a0a, #3a1a1a);
  --card5:linear-gradient(135deg, #1e1e2f, #3b1f52);

}

/* Use variables in your CSS */
body {

  height: 100vh;          /* fill screen */
  display: flex;
  flex-direction: column;
  margin: 0;
    justify-content: center;
    align-items: center;
  font-family: "Poppins", sans-serif;  
  background: ;  
  color: var(--text-light);  
  padding:0;
  transition: background 0.3s, color 0.3s; 
}

.mainbodycontainer{
  display:flex;
  align-items: center;
  justify-content:center;
  flex-direction:column ;
  width:98vw;
  height:92vh;
  position: relative ;
  top:1px;
/*flex: 1 1 auto;         /* take remaining height */
  overflow-y:auto;       /* vertical scroll only */
  
border-radius: 20px;
backdrop-filter: blur(15px) saturate(180%);
-webkit-backdrop-filter: blur(15px) saturate(180%);
border: 1px solid rgba(255, 255, 255, 0.25);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);

text-align: center;

  
}

/* Glassmorphism card */


/* Chrome, Edge, Safari */
/*::-webkit-scrollbar {
  width: 12px;
  background: transparent; /* invisible when not hovered 
}

::-webkit-scrollbar-track {
  background: transparent; 
}

::-webkit-scrollbar-thumb {
  background: rgba(25, 108, 190, 0.56);
  backdrop-filter: blur(12px) saturate(180%);
-webkit-backdrop-filter: blur(12px) saturate(180%);
border: 1px solid rgba(255, 255, 255, 0.2);
box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);
  border-radius: 22px;
  transition: all 0.3s ease;
}
*/
/* Show scrollbar only on hover */
/*.mainbodycontainer:hover::-webkit-scrollbar-thumb {
  
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);
}

.mainbodycontainer:hover::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, rgba(102,126,234,0.6), rgba(118, 75, 162, 1));
  border: 2px solid rgba(255, 255, 255, 0.3);
}*/

/* Firefox (auto-hide + glassy colors) */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 105, 105, 1) rgba(177, 51, 51, 1);
}






body.dark {  
  background: var(--bg-dark);  
  color: var(--text-dark);  
}  

.navcontainer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-direction:column;
  position: fixed;
  gap:0;
  
  
  flex: 0 0 auto;         /* don't grow or shrink */
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--primary, #1e3a8a);
  color: white;
  padding: 0rem 0rem;
}






/* Navbar stays at top */
/*header.navcontainer {
  
}
*/
/* Scrollable main area */
/*.mainbodycontainer {
  
}
*/
/* Content inside main */
#content {
  background:;
  width:100%;      /* optional, center content */
   position: absolute;
   top:0;
  margin: 0;
  padding: 0;
}








header {  
  background: var(--primary);  
  color: white;  
  padding: 0.8rem 0rem;  
  display: flex;  
  justify-content: space-between;  
  align-items: center;  
  margin: 0;
  width:100vw;
  overflow:hidden;

}  
header h1 { margin: 0; margin-left:3px;font-size: 1.2rem; }  
header .actions button {  
  background: none;  
  border: none;  
  color: white;  
  cursor: pointer;  
}  
nav {
  display: flex;
  align-items: flex-start;
  justify-content: ;
  overflow-x: auto;
  overflow-y: hidden;    /* prevents vertical scrollbar stub */
  scrollbar-width: none;/* Firefox */
  background:;
  gap:5px;
  margin: 0;
  height:cover;
  border-radius:12px;
  font-size: 0;
  background:#FFFFFF;
  border:none;
  box-shadow: 
    inset 10px 0 10px -5px rgba(140, 140, 140, 0.4),   /* Left side shadow */
    inset -10px 0 10px -5px rgba(89, 89, 89, 0.4);  /* Right side shadow */
}


nav::-webkit-scrollbar { 
  display: none;         /* Chrome/Safari */
}
body.dark nav {
  background:var(--bg-dark);
 box-shadow: 
    inset 8px 0 12px -6px rgba(255, 255, 255, 0.19),  /* Left inner glow */
    inset -8px 0 12px -6px rgba(255, 255, 255, 0.18); /* Right inner glow */
}


.dashboardbtn{
line-height: 1;
padding: 0.65rem 1rem;
background: transparent;
border: none;
border:2px solid #FFFFFF;
border-radius:10px;
cursor: pointer;
margin-bottom: 2px;
margin-right:2px;
color: white;
font-size: 14px;
font-weight: 500;
transition: all 0.25s ease;
}
body.dark .dashboardbtn {
border:2px solid #FFFFFF;
  
}


/* --- Tabs --- */
nav .tab-btn {
  
  line-height: 1;
  padding: 0.65rem 0.5rem;
  background: transparent;
  border: none;
  border:1px solid rgba(165, 165, 165, 1);
cursor: pointer;
  margin: 2px;
  border-radius:7px 7px 7px 7px;
  margin-right:0;
  color: white;
  font-size: 14px;
  font-weight: 500;
  
  
  display: flex;
justify-content: space-evenly;
align-items: center;
  
  
  
  transition: all 0.15s ease;   /* smooth hover + active */
  
  
  
}

/* Light mode text color */
body:not(.dark) nav .tab-btn {
  color: #000000;
  background:;
   box-shadow: inset 8px 0 12px -6px rgba(217, 217, 217, 0.59),
 inset -8px 0 12px -6px rgba(189, 189, 189, 0.6);
 /* Right inner glow */
 cursor: pointer;
 box-shadow:2px 2px 12px lightgrey;
  border:1px solid rgba(75, 75, 75, 1);
}

/* Hover effect */
nav .tab-btn:hover {
  background: rgba(255, 255, 255, 0.1);
   /* golden glow underline */
}

/* Active tab */
body:not(.dark) nav .tab-btn.active {
  background: #FFFFFF;
  color: black;
  /* merge with nav */
   /*border-radius:12px 12px 0 0;*/
  box-shadow: 0 -2px 6px rgba(0,0,0,0.2);
  z-index: 2;
  border:2px solid rgba(0, 0, 0, 1);
}

/* Dark mode active tab */
body.dark nav .tab-btn.active {
  
/*  border-radius:6px 6px 0 0;*/
  color: white;
  border:3px solid rgba(255, 255, 255, 1);
  
 backdrop-filter: blur(15px) saturate(180%);
-webkit-backdrop-filter: blur(15px) saturate(180%);

box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);

}

/* Tab close button */
.tab-close {
  margin-left: 12px;
  cursor: pointer;
  font-size: 1rem;
  color: #000000;
  transition: color 0.25s ease;
}
body.dark .tab-close {
  color: #D1FF00;
}
.tab-close:hover {
  color: red;
}
.actions {
display: flex;
gap: 2rem;
align-items: center;
margin-right:1rem;
}

.action-btn {
display: flex;
flex-direction: column;
align-items: center;
cursor: pointer;
color: white;
position: relative;
}

.action-btn small {
font-size: 0.7rem;
margin-top: 2px;
opacity: 0.9;

/* Fix left margin or spacing /
margin-left: 0;
padding-left: 0;
text-align: center;
display: block; / make sure small acts like a block and centers properly */
width: 100%;
}

/* Hover tooltip */
.action-btn::after {
content: attr(title);
position: absolute;

bottom: -1rem;
background: rgba(0, 0, 0, 0.8);
color: white;
padding: 3px 2px;
border-radius: 4px;
font-size: 0.7rem;
white-space: nowrap;
opacity: 0;
pointer-events: none;
transition: opacity 0.2s ease;
}

.action-btn:hover::after {
opacity: 1;
}

.plus-tab { font-weight: bold;}
main { 
  padding: 1rem; 
  background:;

  
}

.dashboardheading{
  color:black;
  

}
body.dark .dashboardheading{
  color:white;
  
}
/* Dashboard */
.dashboard-grid {
display: grid;
gap: 1rem;
border-radius:10px;
border:;
background:;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
padding: 1rem;
}

.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  width: max-content;
  max-width: 200px;
  background: rgba(0, 0, 0, 0.75);
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 8px;
  position: absolute;
  z-index: 1000;
  bottom: 125%; /* show above element */
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  font-size: 0.75rem;
  pointer-events: none;
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}





.dashboard-card {
  border-radius: 12px;
  padding: 1rem;
  color: white;
  display: flex;
  flex-direction: column;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  transition: transform 0.2s ease, box-shadow 0.2s ease; /* ðŸ”¥ Smooth hover */
  animation: cardEnter 0.5s ease forwards;
  opacity: 0;
  transform: translateY(50px);
}










/* Hover effect */
.dashboard-card:hover {
  transform: scale(1.93);  /* Slight scale up */
  box-shadow: 0 8px 16px rgba(0,0,0,0.25);
}



@keyframes cardEnter {
  0% {
    opacity: 0;
    transform: translateY(50px);
  }
  
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}




/* Colors repeat every 5 cards */
.dashboard-card:nth-child(5n + 1) { background: var(--card1); }
.dashboard-card:nth-child(5n + 2) { background: var(--card2); }
.dashboard-card:nth-child(5n + 3) { background: var(--card3); }
.dashboard-card:nth-child(5n + 4) { background: var(--card4); }
.dashboard-card:nth-child(5n + 5) { background: var(--card5); }

/* Stagger delays for wave effect */

/* Slide + fade in animation */


.card-progress {
  width: 100%;
  background: #eee;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  margin: 0.5rem 0;
}

.card-progress-bar {
  height: 100%;
  background: #20966F; /* green */
  transition: width 0.3s ease;
}

/* Tracker */
.progress-container { background: #ddd; border-radius: 10px; overflow: hidden; height: 10px; margin: 0.5rem 0; }
.progress-bar { background: var(--primary); height: 100%; width: 0;border-radius: 2px; transition: width 0.5s ease-in-out; }
.week-title { font-weight: bold; margin-top: 1rem; }
label.checkbox {
display: flex; align-items: center; gap: 0.8rem;
background: #DFDFDF; padding: 0.7rem 1rem; border-radius: 12px;
cursor: pointer; margin-bottom: 0.5rem;
}
body.dark label.checkbox { background: #374151; }
input[type="checkbox"] { display: none; }
.checkmark {
width: 24px; height: 24px; background: #FFFFFF; border-radius: 6px;
position: relative; transition: background 0.3s;
}
input:checked + .checkmark { background: var(--primary); animation: pop 0.3s ease; }
@keyframes pop { 50% { transform: scale(1.3); } }
.checkmark svg {
position: absolute; top: 3px; left: 5px; width: 14px; height: 14px;
stroke: white; stroke-width: 3; fill: none; opacity: 0; transition: opacity 0.2s;
}
input:checked + .checkmark svg { opacity: 1; }

/* Modal with Floating Labels */
.modal-overlay {
position: fixed; top:0; left:0; right:0; bottom:0;
background: var(--overlay); display: none;
align-items: center; justify-content: center; z-index: 100;
}
.modal {
background: #EDEAD8; border-radius: 12px; padding: 1rem;
width: 90%; max-width: 400px; text-align: center;
}
body.dark .modal { background:linear-gradient(195deg, #000000 , #00358F ); color: white; }

.modal h2 { margin-top: 0; }
.form-group { position: relative; margin-top: 1.5rem; }
.modal input {
  
width: 96%; padding: 10px 10px 10px 5px;
border: none; border-bottom: 2px solid #7E7C7C;
background: transparent; font-size: 1rem;
color: inherit;
}

.modal input:focus { outline: none; border-bottom: 2px solid black; }
body.dark .modal input{
border-bottom: 2px solid #FFFFFF;
  
}
body.dark .modal input:focus { outline: none; border-bottom: 2px solid white; }
.modal label {
position: absolute; top: 10px; left: 5px;
font-size: 1rem; color: #000000;
transition: 0.3s ease all; pointer-events: none;
}
body.dark .modal label {
  color: #FFF6F6;
}
.modal input:focus ~ label,
.modal input:valid ~ label {
top: -10px; font-size: 0.8rem; color: var(--primary);
}
.modal button {
  
margin-top: 1rem; padding: 0.6rem; width: 45%; 
border-radius: 8px; font-size: 1rem;
background: var(--primary); color: white; border: none;
cursor: pointer;
}

.modal {
  position: relative; /* <-- ensure the modal is relatively positioned */
}

.modal-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5rem;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  transition: color 0.2s ease;
}

.modal-close:hover {
  color: #ff5555;
}






.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modal-buttons button {
  padding: 0.6rem 1rem;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  border: none;
}

/* Primary button: like Yes, Create */
.modal-buttons button[type="submit"] {
  background: green;
  color: white;
}

/* Cancel button */
.modal-buttons button.cancel-btn {
  background: transparent;
border: 1px solid transparent;
border-radius: 12px;
background: linear-gradient(#C71F1F, #C71F1F);
  color: rgba(255, 255, 255, 1);
  
}

.modal-buttons button.cancel-btn:hover {
  background:rgba(220, 233, 242, 0.38);
  border: 1px solid transparent;
border-radius: 8px;
background: linear-gradient(#C71F1F, #C71F1F);
color: black ;
}


.card-buttons {
  display: flex;
  justify-content: space-between;
  gap: 0.8rem;
  margin-top: 0.8rem;
}

.card-buttons button {
  flex: 1;
  padding: 0.5rem;
  font-size: 0.9rem;
  border-radius: 8px;
  cursor: pointer;
  border: none;
}

/* Open = primary style */
.card-buttons .open-btn {
  background: var(--primary);
  color: white;
}

/* Reset = outlined subtle style */
.card-buttons .reset-btn {
  background: transparent;
  border: 1px solid white;
  color: white;
}

.card-buttons .reset-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}



body:not(.dark) .card-buttons .reset-btn {
  color: var(--text-light);
  border-color: var(--text-light);
}

body:not(.dark) .card-buttons .reset-btn:hover {
  background: rgba(0, 0, 0, 0.05);
}

body:not(.dark) .card-buttons .open-btn {
  color: white;
  background: var(--primary);
}



.theme-toggle-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 0.75rem;
  gap: 0.2rem;
  margin-top: 0.5rem;
  color: var(--text-light);
}

body.dark .theme-toggle-wrapper small {
  color: var(--text-dark);
}

#themeToggle {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
}

#themeIcon svg {
  width: 100%;
  height: 100%;
}



#tabs-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  
  gap:5px;
width:99vw;
margin:0;

  padding: 0 0; /* optional: some side padding */
border:none;
  /*border-bottom: 1px solid var(--separator-color);*/
  background-color: var(--bg-primary);
}

#tabs {
  flex-grow: 1;
  display: ;
  
  text-align:center;
  overflow-x: auto;
  white-space: nowrap;
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
}

/* Optional: Custom scrollbar for webkit browsers */
#tabs::-webkit-scrollbar {
  height: 6px;
}
#tabs::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
}
#tabs::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb);
  border-radius: 3px;
}

/* Plus button styles */
#addTabBtn {
  flex-shrink: 0;
  font-size: 1.5rem;
  padding: 0.225rem 1.01rem;
  cursor: pointer;
  background-color: #44B8EB;
  border: none;
  box-shadow:-1px 0px 3px #3368F761;
  color: var(--btn-text);
  border-radius: 2px;
  margin-right:1px;
  right:0%;
  display:flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  position: relative ;
  transition: background-color 0.3s ease;
}
body.dark #addTabBtn{
background-color: #FFFFFF;
color:black;
box-shadow:-1px 0px 3px #0B57FA99;
}
#addTabBtn:hover {
  background-color: #5DA7FF;
}

/* Existing tab button styles should be compatible */



.dashboardbtn,#deleteAllTabsBtn{
  position: relative;
  cursor: pointer;
}

.dashboardbtn::after , #deleteAllTabsBtn::after{
  content: attr(data-tooltip);
  position: absolute;
  bottom: 115%; /* above button */
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.75);
  color: white;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.75rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease-in-out;
  z-index: 1000;
}

.dashboardbtn:hover::after,  #deleteAllTabsBtn:hover::after{
  opacity: 1;
}
 #addTabBtn {
  position: relative;
  cursor: pointer;
}
 #addTabBtn::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 105%; /* above the button */
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.75);
  color: white;
  width:20px;
  height:auto;
  text-align: center;
  
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 0.75rem;
  white-space: wrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease-in-out;
  z-index: 1000;
}

#addTabBtn:hover::after {
  opacity: 1;
}

























/* Celebration */
.celebration-popup {
position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
background: var(--primary); color: white;
padding: 1rem 1.5rem; border-radius: 12px;
font-size: 1.1rem; opacity: 0; transition: opacity 0.3s;
z-index: 200;
}
.celebration-popup.show { opacity: 1; }
#confetti-canvas {
position: fixed; top:0; left:0; width:100%; height:100%;
pointer-events: none; z-index: 199;
}

</style>  
</head>  <script>  
if ("serviceWorker" in navigator) {  
  navigator.serviceWorker.register("./sw.js")  
    .then(() => console.log("âœ… Service Worker registered"))  
    .catch((err) => console.error("SW registration failed:", err));  
}  
</script>  <body>  
<canvas id="confetti-canvas"></canvas> 

<div class="navcontainer">

<header>    <h1 style="font-weight:1000;font-size: 1.35rem;">Day Tracker</h1>  
  <div class="actions">  
<div class="theme-toggle-wrapper">
  <button id="themeToggle" onclick="toggleDarkMode()" aria-label="Toggle Theme">
    <span id="themeIcon"></span>
  </button>
  <small id="themeToggleLabel">Switch to Dark Mode</small>
</div>
    <div class="action-btn" onclick="exportData()" title="Export Data">  
      <span class="material-icons">file_upload</span>  
      <small>Export</small>  
    </div>  
    <div class="action-btn" onclick="importData()" title="Import Data">  
      <span class="material-icons">file_download</span>  
      <small>Import</small>  
    </div>  
    <div class="action-btn" id="resetBtn" style="display:none;" title="Reset">  
      <span class="material-icons">restart_alt</span>  
      <small>Reset</small>  
    </div>  
  </div>  
</header> <div id="tabs-wrapper">
  <nav id="tabs"></nav>
  <button id="addTabBtn" class="plus-tab">
    +
    </button>
</div>
</div>
<div class="mainbodycontainer">
<main id="content">
  <div id="day-container">
    
  </div>
  
</main> 

</div>
<div class="modal-overlay" id="modalOverlay">  

<div class="modal" id="modalBox">
  <span class="modal-close" onclick="document.getElementById('modalOverlay').style.display='none'">&times;</span>
  <h2 id="modalTitle"></h2>
  <div id="modalBody"></div>
</div>
</div>  <div class="celebration-popup" id="celebrationPopup"></div>  
</body>

<script>  


function updateDashboardMessageColors() {
  const container = document.querySelector('#day-container > div');
  if (!container) return;
  
  const isDark = document.body.classList.contains('dark');
  container.style.color = isDark ? 'var(--text-dark)' : 'var(--text-light)';
  
  const btn = container.querySelector('button');
  if (btn) {
    btn.style.background = 'var(--primary)';
    btn.style.color = 'white';
    btn.style.border = 'none';
    btn.style.padding = '0.4rem 1rem';
    btn.style.borderRadius = '8px';
    btn.style.cursor = 'pointer';
  }
}
  
  






document.querySelectorAll('.dashboard-card').forEach((card, index) => {  
  card.style.setProperty('--i', index);  
});  
  
  
  

let allTabs = JSON.parse(localStorage.getItem('allTabs')) || { Dashboard: null };    
let currentTab = localStorage.getItem('currentTab') || 'Dashboard';    
let completedWeeks = JSON.parse(localStorage.getItem('completedWeeks')) || {};    
let completedTabs = JSON.parse(localStorage.getItem('completedTabs')) || {};    
    
function saveTabs() {    
  localStorage.setItem('allTabs', JSON.stringify(allTabs));    
  localStorage.setItem('currentTab', currentTab);    
  localStorage.setItem('completedWeeks', JSON.stringify(completedWeeks));    
  localStorage.setItem('completedTabs', JSON.stringify(completedTabs));    
}    
    
function toggleDarkMode() {  
  document.body.classList.toggle('dark');  
  const isDark = document.body.classList.contains('dark');  
  localStorage.setItem('darkMode', isDark);  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
  updateDashboardMessageColors();
  updateThemeToggleLabel();  
}  
  
  
  
  
  
function updateThemeToggleLabel() {  
  const label = document.getElementById('themeToggleLabel');  
  const icon = document.getElementById('themeIcon');  
  const isDark = document.body.classList.contains('dark');  
    
  label.textContent = isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode';  
    
  icon.innerHTML = isDark ?  
    `<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="white" viewBox="0 0 24 24"><path d="M21.752 15.002a9.992 9.992 0 0 1-11.118-12.68 1 1 0 0 0-1.555-1.09A10.996 10.996 0 1 0 22.85 16.557a1 1 0 0 0-1.098-1.555Z"/></svg>` :  
    `<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="black" viewBox="0 0 24 24"><path d="M12 4.5a1 1 0 0 1-1-1V2a1 1 0 0 1 2 0v1.5a1 1 0 0 1-1 1Zm0 17a1 1 0 0 1-1-1V22a1 1 0 0 1 2 0v-1.5a1 1 0 0 1-1 1ZM4.5 13a1 1 0 0 1-1-1 1 1 0 0 1 0-2h1.5a1 1 0 0 1 0 2H4.5Zm14.5 0a1 1 0 0 1-1-1 1 1 0 0 1 0-2h1.5a1 1 0 0 1 0 2H19ZM6.22 6.22a1 1 0 0 1 1.42 0l1.06 1.06a1 1 0 1 1-1.42 1.42L6.22 7.64a1 1 0 0 1 0-1.42Zm10.1 10.1a1 1 0 0 1 1.42 0l1.06 1.06a1 1 0 0 1-1.42 1.42l-1.06-1.06a1 1 0 0 1 0-1.42ZM6.22 17.78a1 1 0 0 1 0-1.42l1.06-1.06a1 1 0 1 1 1.42 1.42L7.64 17.78a1 1 0 0 1-1.42 0Zm10.1-10.1a1 1 0 0 1 0-1.42l1.06-1.06a1 1 0 1 1 1.42 1.42l-1.06 1.06a1 1 0 0 1-1.42 0ZM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z"/></svg>`;  
}  
  
if (localStorage.getItem('darkMode') === 'true') {  
  document.body.classList.add('dark');  
}  
updateThemeToggleLabel(); // Call this after setting dark class  
  
  
  
  
function launchConfetti(intensity) {    
  const canvas = document.getElementById('confetti-canvas');    
  const ctx = canvas.getContext('2d');    
  canvas.width = window.innerWidth;    
  canvas.height = window.innerHeight;    
  let particles = [];    
  for (let i = 0; i < intensity; i++) {    
    particles.push({    
      x: Math.random() * canvas.width,    
      y: Math.random() * canvas.height - canvas.height,    
      r: Math.random() * 6 + 4,    
      d: Math.random() * intensity,    
      color: `hsl(${Math.random()*360}, 100%, 50%)`    
    });    
  }    
  function draw() {    
    ctx.clearRect(0, 0, canvas.width, canvas.height);    
    particles.forEach(p => {    
      ctx.beginPath();    
      ctx.fillStyle = p.color;    
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2, true);    
      ctx.fill();    
    });    
    update();    
  }    
  function update() {    
    particles.forEach(p => {    
      p.y += Math.cos(p.d) + 1 + p.r/2;    
      p.x += Math.sin(p.d);    
      if (p.y > canvas.height) {    
        p.x = Math.random() * canvas.width;    
        p.y = -10;    
      }    
    });    
  }    
  let interval = setInterval(draw, 20);    
  setTimeout(() => { clearInterval(interval); ctx.clearRect(0,0,canvas.width,canvas.height); }, 4000);    
}    


const c = document.getElementById('day-container');
    c.style="position:;z-index:-100;width:;padding:2rem 1rem;background: transparent;    ";
    
    
function showCelebrationPopup(message, full=false) {    
  const pop = document.getElementById('celebrationPopup');    
  pop.textContent = message;    
  pop.classList.add('show');    
  launchConfetti(full ? 200 : 60);    
  setTimeout(() => pop.classList.remove('show'), 3000);    
}    
    
function checkCelebrations(data) {    
  // Check each week    
  data.weeks.forEach((w, i) => {    
    const key = `${currentTab}-w${i}`;    
    const isComplete = w.every(d => d.checked);    
        
    if (isComplete && !completedWeeks[key]) {    
      // Mark as complete and celebrate    
      completedWeeks[key] = true;    
      saveTabs();    
      showCelebrationPopup(`Week ${i + 1} complete`, false);    
    }    
    else if (!isComplete && completedWeeks[key]) {    
      // Reset so it can celebrate again    
      completedWeeks[key] = false;    
      saveTabs();    
    }    
  });    
  
  
  
  
  
  
  
  
  
  
      
  // Check entire tab completion    
  const allComplete = data.weeks.every(w => w.every(d => d.checked));    
  if (allComplete && !completedTabs[currentTab]) {    
    completedTabs[currentTab] = true;    
    saveTabs();    
    showCelebrationPopup(`All done for ${currentTab}!`, true);    
  }    
  else if (!allComplete && completedTabs[currentTab]) {    
    completedTabs[currentTab] = false;    
    saveTabs();    
  }    
}    
    
function showModal(title, html, onSubmit) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').innerHTML = html;
  document.getElementById('modalOverlay').style.display = 'flex';
  
  const form = document.querySelector('#modalBody form');
  if (form) {
    form.onsubmit = e => {
      e.preventDefault();
      // Pass a function to close modal, so onSubmit can decide when
      onSubmit(new FormData(form), () => {
        document.getElementById('modalOverlay').style.display = 'none';
      });
    };
  }
}
    
function createTrackerData(fd) {    
  const topic = fd.get('topic');    
  const days = parseInt(fd.get('days'));    
  const start = new Date(fd.get('startDate'));    
  const weeks = [];    
  let cur = [];    

  for (let i = 0; i < days; i++) {    
    const d = new Date(start);    
    d.setDate(start.getDate() + i);    
    const lbl = `${d.toLocaleDateString('en-US', {weekday:'long'})} (${d.toLocaleDateString('en-GB')})`;    
    cur.push({label: lbl, checked: false});    
    if ((i + 1) % 7 === 0 || i === days - 1) { weeks.push(cur); cur = []; }    
  }    

  return { topic, weeks, days, startDate: start.toISOString().split('T')[0] };    
}
const tabsWrapper=document.getElementById('tabs-wrapper');
  // Dashboard button with tooltip
const dash = document.createElement('button');
dash.className = 'dashboardbtn' + (currentTab === 'Dashboard' ? ' active' : '');
dash.textContent = 'Dashboard';
dash.onclick = () => { currentTab = 'Dashboard'; saveTabs(); render(); };

// Add tooltip text as a data attribute
dash.setAttribute('data-tooltip', 'View Dashboard');

tabsWrapper.insertBefore(dash, tabsWrapper.firstChild);
    
function renderTabs(){    
  const nav=document.getElementById('tabs');nav.innerHTML='';    
  
  Object.keys(allTabs).forEach(tab=>{    
    if(tab==='Dashboard') return;    
    const btn=document.createElement('button');btn.className='tab-btn'+(currentTab===tab?' active':'');
    btn.textContent=tab; 
 /* const tabcontent=document.createElement('h4');
  tabcontent.className='tabcontent';
    tabcontent.style="margin:0;overflow-x:auto;width:50%;";
    
    tabcontent.textContent=tab;    
    
    btn.appendChild(tabcontent);*/
    
  
    btn.onclick=()=>{currentTab=tab;saveTabs();render();};    
    const close=document.createElement('span');close.className='tab-close';close.textContent='Ã—';    
    close.onclick=e=>{e.stopPropagation();showModal('Delete Tab', `  
  <form>  
    <p>All data will be erased for "${tab}". Are you sure?</p>  
    <div class="modal-buttons">  
  
      <button type="submit">Yes</button>  
          <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>  
    </div>  
  </form>  
`, () => {  
  delete allTabs[tab];  
  saveTabs();  
  if (currentTab === tab) currentTab = 'Dashboard';  
  render();  
});};    
    btn.appendChild(close);
    nav.style="padding:0 1rem"
    nav.appendChild(btn);    
  });    
  
  
  
  // Dashboard button


// Wrap with tooltip


// Add Tab button (+)


// Delete All Tabs button

  
  
}    
    
function renderDashboard() {
  const c = document.getElementById('day-container');
  c.innerHTML = '';
  
  // Filter tabs excluding Dashboard and ensure they exist
  const tabs = Object.keys(allTabs).filter(t => t !== 'Dashboard' && allTabs[t]);
  if (tabs.length === 0) {
    // Show message + button to add new tab
    const div = document.createElement('div');
    div.style.textAlign = 'center';
    div.style.marginTop = '3rem';
    div.innerHTML = `<p>Add new tabs to track days</p>`;
    const btn = document.createElement('button');
    btn.textContent = '+ Add New Tab';
    btn.onclick = () => {
      document.querySelector('.plus-tab').click(); // trigger plus tab button
    };
    div.appendChild(btn);
    c.appendChild(div);
    
    // Update colors based on dark/light mode
    updateDashboardMessageColors();
    return;
  }
  
  // Normal dashboard grid render
  c.innerHTML = '<h1 class="dashboardheading" style="border:none;text-align:center;">DASHBOARD</h1><div class="dashboard-grid"></div>';
  
  
  
  
  
  

  
  
  
  
  
  
  
  
  
  
  const grid = c.querySelector('.dashboard-grid');
  
  tabs.forEach((tab, i) => {
    const tr = allTabs[tab],
      total = tr.weeks.flat().length,
      done = tr.weeks.flat().filter(d => d.checked).length;
    const pct = Math.round(done / total * 100);
    
    const card = document.createElement('div');
    
  
    
    card.className = 'dashboard-card';
    card.innerHTML = `
      <h3>${tab}</h3>
      <p>${tr.topic}</p>
      <div class="card-progress">
        <div class="card-progress-bar" style="width:${pct}%"></div>
      </div>
      <small>${pct}%</small>
      <canvas id="pie-${i}" height="100"></canvas>
      <canvas id="bar-${i}" height="100"></canvas>
      <div class="card-buttons">
        <button class="open-btn" onclick="openTab('${tab}')">Open</button>
        <button class="reset-btn" onclick="resetTracker('${tab}')">Reset</button>
      </div>
    `;
    
    grid.appendChild(card);
    
    setTimeout(() => {
      const pctx = document.getElementById(`pie-${i}`).getContext('2d');
      new Chart(pctx, {
        type: 'pie',
        data: {
          labels: ['Done', 'Remaining'],
          datasets: [{
            data: [done, total - done],
            backgroundColor: ['#10b981', '#ef4444']
          }]
        },
        options: {
          plugins: {
            legend: {
              labels: { color: 'white' }
            }
          }
        }
      });
      
      const wb = tr.weeks.map(w => Math.round(w.filter(d => d.checked).length / w.length * 100));
      const bctx = document.getElementById(`bar-${i}`).getContext('2d');
      new Chart(bctx, {
        type: 'bar',
        data: {
          labels: wb.map((_, idx) => `W${idx + 1}`),
          datasets: [{
            label: '%',
            data: wb,
            backgroundColor: '#fff'
          }]
        },
        options: {
          scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
          },
          plugins: { legend: { display: false } }
        }
      });
    }, 50);
  });
  
  
  // Add Delete All Tabs button inside dashboard grid
const existingBtn = document.getElementById('deleteAllTabsBtn');
if(existingBtn) existingBtn.remove(); // remove old button if exists

if (Object.keys(allTabs).length > 1) { // only show if there are tabs
  const delBtn = document.createElement('button');
  delBtn.id = 'deleteAllTabsBtn';
  delBtn.textContent = 'Delete All Tabs';
  /*const deleteWrapper = document.createElement('div');
deleteWrapper.className = 'tooltip';
delBtn.appendChild(deleteWrapper);
deleteWrapper.innerHTML += `<span class="tooltip-text">Delete all tabs</span>`;
  
  */
  
delBtn.setAttribute('data-tooltip', 'Delete all tabs permanently!!');
  delBtn.style.cssText = `
    background: #ef4444;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    margin: 1rem auto;
    display: block;
    transition: transform 0.2s, background 0.2s;
  `;
  delBtn.onmouseover = () => { delBtn.style.transform = 'scale(1.05)'; delBtn.style.background = '#dc2626'; };
  delBtn.onmouseout = () => { delBtn.style.transform = 'scale(1)'; delBtn.style.background = '#ef4444'; };
delBtn.onclick = () => {
  showModal('Delete All Tabs', `
    <form>
      <p>All tabs except Dashboard will be erased. Are you sure?</p>
      <div class="modal-buttons">
        <button type="submit">Yes</button>
        <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>
      </div>
    </form>
  `, (fd, closeModal) => { // <-- fd not needed here, closeModal is provided
    Object.keys(allTabs).forEach(tab => { if (tab !== 'Dashboard') delete allTabs[tab]; });
    saveTabs();
    render();
    closeModal(); // <-- close the modal automatically
  });
};
  
  const grid = document.querySelector('.dashboard-grid');
  if(grid) grid.after(delBtn); // place it right below grid
}
  
  
  
  
  
  
  
  
  
  
  
}
    
function openTab(tab){currentTab=tab;saveTabs();render();}    
    
function resetTracker(tab) {  
  showModal(  
    'Reset Tracker',  
    `<form>  
       <p>All checkmarks for "${tab}" will be cleared. Continue?</p>  
       <div class="modal-buttons">  
         <button type="submit">Yes</button>  
         <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>  
       </div>  
     </form>`,  
    () => {  
      // 1. Uncheck all days  
      allTabs[tab].weeks.forEach(week => {  
        week.forEach(day => {  
          day.checked = false;  
        });  
      });  
        
      // 2. Clear completion flags  
      delete completedTabs[tab];  
      Object.keys(completedWeeks).forEach(key => {  
        if (key.startsWith(tab + "-w")) {  
          delete completedWeeks[key];  
        }  
      });  
        
      // 3. Save & re-render  
      saveTabs();  
      render();  
    }  
  );  
}  
    
function renderTracker() {  
  const tr = allTabs[currentTab];  
  const c = document.getElementById('day-container');  
  c.innerHTML = '';  
    
  // Calculate overall done and total days  
  const allDays = tr.weeks.flat();  
  const doneTotal = allDays.filter(d => d.checked).length;  
  const totalDays = allDays.length;  
    
  // Create top info container  
  const infoDiv = document.createElement('div');  
  infoDiv.style.display = 'flex';  
  infoDiv.style.flexDirection = 'column';  
  infoDiv.style.alignItems = 'flex-start';  
  infoDiv.style.marginBottom = '1rem';  
  infoDiv.style.color = 'var(--text-light)'; // respects theme colors  
    
  // Start date line  
  const startDateLine = document.createElement('div');  
  startDateLine.className=''  
  // Extract date string like "08/08/2025"
const dateStr = tr.weeks[0][0].label.match(/\((.*)\)/)[1];
// Split dd/mm/yyyy
const [dd, mm, yyyy] = dateStr.split('/');
// Create valid date object
const startDate = new Date(yyyy, mm - 1, dd);
startDateLine.textContent = `Start Date: ${startDate.toLocaleDateString('en-GB')}`;
  startDateLine.style.fontWeight = 'bold';  
  infoDiv.appendChild(startDateLine);  
    
  // Overall completion fraction line  
  const overallProgressLine = document.createElement('div');  
  overallProgressLine.textContent = `${doneTotal} / ${totalDays} days completed`;  
  overallProgressLine.style.marginTop = '0.5rem';  
  overallProgressLine.style.fontWeight = 'bold';  
  infoDiv.appendChild(overallProgressLine);  
    
  // Separator line  
  const separator = document.createElement('hr');  
  separator.style.width = '100%';  
  separator.style.borderColor = '#999';  
  separator.style.margin = '0.7rem 0';  
  infoDiv.appendChild(separator);  
    
    
    
    
  infoDiv.style.color = 'var(--text-primary)';  
  overallProgressLine.style.color = 'var(--text-primary)';  
separator.style.borderColor = 'var(--separator-color)';  
  
    
c.appendChild(infoDiv);  
    
  // Render each week  
  tr.weeks.forEach((week, wi) => {  
    const title = document.createElement('div');  
    title.className = 'week-title';  
    title.textContent = `Week ${wi + 1} â€“ ${tr.topic}`;  
    c.appendChild(title);  
      
    // Weekly done and total  
    const done = week.filter(d => d.checked).length;  
    const tot = week.length;  
      
    // Progress bar container  
    const pc = document.createElement('div');  
    pc.className = 'progress-container';  
      
    // Progress bar  
    const pb = document.createElement('div');  
    pb.className = 'progress-bar';  
    pb.style.width = `${Math.round(done / tot * 100)}%`;  
    pc.appendChild(pb);  
    c.appendChild(pc);  
      
    // Weekly completion fraction (like 2/7 days)  
    const prc = document.createElement('div');  
    prc.style.width = 'auto';  
    prc.style.height = 'auto';  
    prc.style.display = 'flex';  
    prc.style.padding = '0.3rem 0.8rem';  
    prc.style.alignItems = 'center';  
    prc.style.justifyContent = 'center';  
    prc.style.fontWeight = 'bold';  
    prc.style.margin = '3px';  
    prc.textContent = `${done} / ${tot} days completed`;  
    pc.after(prc);  
      
      
      
      
    // Render each day checkbox  
    week.forEach(day => {  
      const label = document.createElement('label');  
      label.className = 'checkbox';  
        
      const cb = document.createElement('input');  
      cb.type = 'checkbox';  
      cb.checked = day.checked;  
      cb.onchange = () => {
  if (!day.checked) { // Allow checking only if not already checked
    day.checked = true;
    saveTabs();
    checkCelebrations(tr);
    render();
  } else {
    cb.checked = true; // Prevent unchecking by resetting it to checked
  }
};
        
      const mark = document.createElement('span');  
      mark.className = 'checkmark';  
      mark.innerHTML = '<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>';  
        
      label.append(cb, mark, document.createTextNode(day.label));  
      c.appendChild(label);  
      

    });  
  });  
}  
    
// Export / Import    
function exportData(){    
  const blob=new Blob([JSON.stringify({allTabs,completedWeeks,completedTabs})],{type:'application/json'});    
  const url=URL.createObjectURL(blob);    
  const a=document.createElement('a');    
  a.href=url;a.download='day-tracker-data.json';a.click();    
  URL.revokeObjectURL(url);    
}    
function importData(){    
  const inp=document.createElement('input');    
  inp.type='file';    
  inp.accept='.json';    
  inp.onchange=()=>{    
    const file=inp.files[0];    
    if(!file) return;    
    const reader=new FileReader();    
    reader.onload=()=>{    
      try{    
        const data=JSON.parse(reader.result);    
        if(data.allTabs) allTabs=data.allTabs;    
        if(data.completedWeeks) completedWeeks=data.completedWeeks;    
        if(data.completedTabs) completedTabs=data.completedTabs;    
        saveTabs();    
        render();    
      }catch(e){alert('Invalid file');}    
    };    
    reader.readAsText(file);    
  };    
  inp.click();    
}    
    
// Main render    
function render(){    
  
  renderTabs();    
  if(currentTab==='Dashboard'){    
    document.getElementById('resetBtn').style.display='none';    
    renderDashboard();    
  } else {    
    document.getElementById('resetBtn').style='display:flex;flex-direction:column';    
    document.getElementById('resetBtn').onclick=()=>resetTracker(currentTab);    
    renderTracker();    
  }    
}    
    
const addTabBtn = document.getElementById('addTabBtn');
addTabBtn.setAttribute('data-tooltip', 'Add New Tab');


// Remove creation of plus button inside renderTabs

// Instead, after renderTabs(), add this event listener once:
document.getElementById('addTabBtn').onclick = () => {
  
  const modalHTML = `
    <form id="newTabForm">
      <!-- Error message container -->
      <div class="error-msg" style="color:red; margin-bottom:0.5rem;"></div>

      <div class="form-group"><input name="tabName" required><label>Tab name</label></div>
      <div class="form-group"><input name="topic" required><label>Topic name</label></div>
      <div class="form-group"><input type="number" id="dayinputfield" name="days" min="1" required><label>Total days</label></div>
      <div class="form-group"><input type="date" name="startDate" required><label>Start date</label></div>

      <div class="modal-buttons">
        <button type="button" class="cancel-btn" onclick="document.getElementById('modalOverlay').style.display='none'">Cancel</button>
        <button type="submit">Create</button>
      </div>
    </form>
  `;
  
  showModal('New Tab', modalHTML, (fd, closeModal) => {
    const tabName = fd.get('tabName').trim();
    const topic = fd.get('topic').trim();
    const nodays = parseInt(fd.get('days'));
    const startDate = fd.get('startDate');
    
    const errorDiv = document.querySelector('#modalOverlay .error-msg');
    errorDiv.textContent = ''; // clear previous errors
    
    // Check duplicate tab name
    if (allTabs[tabName]) {
      errorDiv.textContent = 'Tab with this name already exists!';
      return;
    }
    
    // Check duplicate topic + days + start date
    for (let key in allTabs) {
      const tab = allTabs[key];
      if (!tab) continue;
      if (tab.topic === topic && tab.days === nodays && tab.startDate === startDate && allTabs[tabName]) {
        errorDiv.textContent = 'A tab with the same topic, days and start date already exists!';
        return;
      }
    }
    
    // Create the tab
    allTabs[tabName] = createTrackerData(fd);
    currentTab = tabName;
    saveTabs();
    render();
    
    // Close modal only after successful creation
    closeModal();
  });
  
  // Limit day input to 3 digits after modal is rendered
  const dayinputfield = document.getElementById('dayinputfield');
  if (dayinputfield) {
    dayinputfield.addEventListener('input', () => {
      if (dayinputfield.value.length > 3) {
        dayinputfield.value = dayinputfield.value.slice(0, 3);
      }
    });
  }
};

// Start app    
render();
</script>    
</html>  